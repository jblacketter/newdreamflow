{% extends 'base.html' %}

{% block title %}Create Story{% endblock %}

{% block extra_head %}
<style>
    .story-form {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        background-color: #ffffff !important;
        border-radius: 0.75rem;
    }
    
    .story-form h1 {
        color: #000000 !important;
        font-weight: 800 !important;
        font-size: 2rem;
        margin-bottom: 2rem;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        opacity: 1 !important;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 700 !important;
        color: #000000 !important;
        font-size: 1rem;
        letter-spacing: -0.01em;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        opacity: 1 !important;
    }
    
    .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #d1d5db !important;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: border-color 0.2s;
        color: #000000 !important;
        font-weight: 500 !important;
        background-color: #ffffff !important;
        opacity: 1 !important;
    }
    
    .form-input::placeholder {
        color: #6b7280;
        opacity: 1;
        font-weight: 400;
    }
    
    .form-input:focus {
        outline: none;
        border-color: #818cf8;
        box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.1);
    }
    
    .form-textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .things-selector {
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        max-height: 400px;
        overflow-y: auto;
        background: #ffffff !important;
    }
    
    .thing-option {
        display: flex;
        align-items: flex-start;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: #f9fafb !important;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .thing-option:hover {
        background: #e5e7eb !important;
    }
    
    .thing-option input[type="checkbox"] {
        margin-right: 0.75rem;
        margin-top: 0.25rem;
    }
    
    .thing-option-content {
        flex: 1;
    }
    
    .thing-option-title {
        font-weight: 700 !important;
        margin-bottom: 0.25rem;
        color: #000000 !important;
        opacity: 1 !important;
    }
    
    .thing-option-date {
        font-size: 0.875rem;
        color: #374151 !important;
        font-weight: 500 !important;
        opacity: 1 !important;
    }
    
    .thing-option-excerpt {
        font-size: 0.875rem;
        color: #1f2937 !important;
        margin-top: 0.25rem;
        line-height: 1.4;
        font-weight: 400 !important;
        opacity: 1 !important;
    }
    
    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
        border: 2px solid transparent;
    }
    
    .btn-primary {
        background: #818cf8;
        color: white;
        border-color: #818cf8;
    }
    
    .btn-primary:hover {
        background: #6366f1;
        border-color: #6366f1;
    }
    
    .btn-secondary {
        background: white;
        color: #374151;
        border-color: #e5e7eb;
    }
    
    .btn-secondary:hover {
        background: #f9fafb;
    }
    
    .selected-count {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: #818cf8;
        color: white;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        margin-left: 1rem;
    }
    
    @media (prefers-color-scheme: dark) {
        /* Override dark mode to keep everything light for readability */
        .story-form {
            background-color: #ffffff !important;
        }
        
        .form-label {
            color: #000000 !important;
            font-weight: 700 !important;
        }
        
        .form-input {
            background: #ffffff !important;
            color: #000000 !important;
            border-color: #d1d5db !important;
        }
        
        .form-input:focus {
            border-color: #818cf8 !important;
        }
        
        .things-selector {
            background: #ffffff !important;
            border-color: #d1d5db !important;
        }
        
        .thing-option {
            background: #f9fafb !important;
        }
        
        .thing-option:hover {
            background: #e5e7eb !important;
        }
        
        .thing-option-title {
            color: #000000 !important;
        }
        
        .thing-option-date {
            color: #374151 !important;
        }
        
        .thing-option-excerpt {
            color: #1f2937 !important;
        }
        
        .btn-secondary {
            background: #f3f4f6 !important;
            color: #374151 !important;
            border-color: #e5e7eb !important;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="story-form">
    <h1>Create New Story</h1>
    
    <form method="post" id="story-form">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="title" class="form-label">Story Title *</label>
            <input type="text" id="title" name="title" class="form-input" required placeholder="Enter your story title">
        </div>
        
        <div class="form-group">
            <label for="description" class="form-label">Description</label>
            <textarea id="description" name="description" class="form-input form-textarea" placeholder="What's this story about?"></textarea>
        </div>
        
        <div class="form-group">
            <label for="privacy_level" class="form-label">Privacy Level</label>
            <select id="privacy_level" name="privacy_level" class="form-input">
                <option value="private">Private</option>
                <option value="specific_users">Specific Users</option>
                <option value="groups">Groups</option>
                <option value="community">Community</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                Select Things for Your Story
                <span class="selected-count" id="selected-count" style="display: none;">0 selected</span>
            </label>
            <div class="things-selector">
                {% if user_things %}
                    {% for thing in user_things %}
                    <label class="thing-option">
                        <input type="checkbox" name="things" value="{{ thing.pk }}" data-title="{{ thing.title|default:'Untitled' }}">
                        <div class="thing-option-content">
                            <div class="thing-option-title">{{ thing.title|default:"Untitled" }}</div>
                            <div class="thing-option-date">{{ thing.thing_date|date:"F j, Y" }}</div>
                            {% if thing.description %}
                            <div class="thing-option-excerpt">{{ thing.description|truncatewords:20 }}</div>
                            {% endif %}
                        </div>
                    </label>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: #6b7280; padding: 2rem;">
                        No things available yet. Create some things first to add them to your story.
                    </p>
                {% endif %}
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Create Story</button>
            <a href="{% url 'things:story_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[name="things"]');
    const selectedCount = document.getElementById('selected-count');
    
    function updateSelectedCount() {
        const checked = document.querySelectorAll('input[name="things"]:checked').length;
        if (checked > 0) {
            selectedCount.textContent = checked + ' selected';
            selectedCount.style.display = 'inline-block';
        } else {
            selectedCount.style.display = 'none';
        }
    }
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedCount);
    });
    
    // Form validation
    document.getElementById('story-form').addEventListener('submit', function(e) {
        const title = document.getElementById('title').value.trim();
        if (!title) {
            e.preventDefault();
            alert('Please enter a story title');
            document.getElementById('title').focus();
        }
    });
});
</script>
{% endblock %}